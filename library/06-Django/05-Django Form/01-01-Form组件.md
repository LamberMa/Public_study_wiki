# Formç»„ä»¶

[TOC]

>Formç»„ä»¶èƒ½ä¸ºæˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ
>
>- æ ¹æ®ç”¨æˆ·è¯·æ±‚å¯¹æ•°æ®åšéªŒè¯
>- æ ¹æ®ç”¨æˆ·çš„è¾“å…¥è¿˜å¯ä»¥è¾“å‡ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯
>- è·å–åˆ°æ•°æ®ç„¶åè¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åå¯¹æ­£ç¡®çš„ä¿¡æ¯è¿›è¡Œæ‰“åŒ…å¹¶æäº¤ã€‚
>- ä¿ç•™ä¸Šä¸€æ¬¡çš„è¾“å…¥å†…å®¹
>- Formç»„ä»¶è¿˜å¯ä»¥åˆ›å»ºHTMLæ ‡ç­¾ï¼Œé€šè¿‡æŒ‚ä»¶æŒ‡å®šæ ·å¼ã€‚
>
>åœ¨æ•°æ®åº“æ“ä½œä¹‹å‰è¿›è¡Œä¸€äº›è§„åˆ™çš„éªŒè¯ã€‚

é—®é¢˜ï¼š

- æ— æ³•è®°ä½ä¸Šæ¬¡æäº¤çš„å†…å®¹ï¼Œå› æ­¤é¡µé¢åˆ·æ–°æ•°æ®æ¶ˆå¤±
- é‡å¤çš„è¿›è¡Œç”¨æˆ·æ•°æ®çš„æ ¡éªŒï¼šæ­£åˆ™ï¼Œé•¿åº¦ï¼Œæ˜¯å¦ä¸ºç©ºã€‚

## Formç»„ä»¶çš„ç®€å•ä½¿ç”¨

### å®šä¹‰ç»„ä»¶

```python
# é¦–å…ˆç®€å•å®šä¹‰ä¸€ä¸ªFormç»„ä»¶ï¼Œç”¨äºç™»å½•éªŒè¯
# æˆ‘ä»¬åœ¨appä¸‹æ–°å»ºä¸€ä¸ªform.pyæ–‡ä»¶ç”¨äºæˆ‘ä»¬å®šä¹‰çš„ForméªŒè¯è§„åˆ™
from django.forms import fields, Form

class LoginForm(Form):
    username = fields.CharField(
        max_length=18,
        min_length=6,
        required=True,
    )
    password = fields.CharField(
        max_length=16,
        min_length=6,
        required=True
    )
```

### ç»„ä»¶çš„åº”ç”¨

```python
# åœ¨viewsè§†å›¾ä¸­ç›´æ¥è°ƒç”¨ï¼Œç›´æ¥æ·»åŠ ä¸€ä¸ªurlè·¯ç”±ç”¨äºåŒ¹é…
form main import form

def login(request):
    if request.method == 'GET':
        # å½“æˆ‘ç›´æ¥è®¿é—®çš„æ—¶å€™å°±ç›´æ¥è¿”å›ç™»å½•é¡µé¢
        return render(request, 'login.html')
    else:
        # ç”Ÿæˆä¸€ä¸ªLoginFormçš„å¯¹è±¡ï¼Œè¦å°†ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥çš„è´¦å·å¯†ç ä¼ å…¥
        obj = form.LoginForm(request.POST)
        # è°ƒç”¨å¯¹è±¡çš„is_vaildæ–¹æ³•è¿›è¡Œè§„åˆ™çš„æ ¡éªŒ
        # è¿”å›å€¼ä¸ºTrue or Falseï¼Œå› æ­¤ç›´æ¥è°ƒç”¨is_valid()å°±å¯ä»¥
        # è¿™ä¸ªæ˜¯ç”±Djangoå†…éƒ¨æä¾›çš„ä¸€ä¸ªéªŒè¯æœºåˆ¶ã€‚
        if obj.is_valid():
            # obj.cleaned_dataæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå°±æ˜¯éªŒè¯é€šè¿‡åï¼Œç”¨æˆ·æäº¤çš„æ•°æ®
            # è¿™æ ·å¦‚æœé‡åˆ°æ³¨å†Œçš„æ—¶å€™åˆ›å»ºç”¨æˆ·ç›´æ¥ä½¿ç”¨create(**kwargs)å°±è¡Œäº†
            print(obj.cleaned_data)
            # æˆ‘ä»¬å…ˆè®©ä»–è¯´éªŒè¯è§„åˆ™é€šè¿‡ä»¥åé‡å®šå‘åˆ°ç™¾åº¦
            return redirect('https://www.baidu.com')
        else:
            # å¦‚æœéªŒè¯ä¸é€šè¿‡åº”è¯¥æ‰“å°é”™è¯¯ä¿¡æ¯ï¼ŒDjangoå†…éƒ¨ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†è¿™ç§æœºåˆ¶ã€‚
            # obj.errorsæ˜¯æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯
            # è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å†…éƒ¨æœ‰ä¸€ä¸ª__str__æ–¹æ³•å› æ­¤æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€å¤§ä¸²htmlå­—ç¬¦ä¸²
            # å‡å¦‚è¯´ç”¨æˆ·æ²¡æœ‰è¾“å…¥é”™è¯¯çš„è¯é‚£ä¹ˆå°±ç›´æ¥æ‹¿ä¸åˆ°äº†ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªå…¶å®æˆ‘ä»¬ä¸ç”¨å¤ªå…³å¿ƒï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šåœ¨åå°ç”¨ï¼Œè€Œæ˜¯ç›´æ¥æ‰”åˆ°å‰ç«¯é‡Œå»ã€‚æˆ‘æ‹¿ä¸åˆ°é¡¶å¤šä¸æ˜¾ç¤ºå°±å®Œäº†ã€‚
            print(obj.errors)
            print(obj.errors['username'])
            # é”™è¯¯å¯ä»¥æ˜¯å­˜åœ¨å¤šä¸ªçš„
            # æ‹¿å¤šä¸ªé”™è¯¯ä¿¡æ¯çš„ç¬¬ä¸€ä¸ªï¼Œåªè¦é”™è¯¯ä¿¡æ¯æ²¡æ»¡è¶³å°±æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬æ°¸è¿œæ‹¿ç¬¬ä¸€ä¸ªå°±è¡Œäº†
            print(obj.errors['password'][0])
            return render(request, 'login.html', {
                'obj': obj
            })
```

### æ ¡éªŒçš„æŠ¥é”™

å‡å¦‚è¯´æ²¡æœ‰æ»¡è¶³éªŒè¯è§„åˆ™çš„è¯å°±ä¼šè¿›è¡ŒæŠ¥é”™ï¼ŒæŠ¥é”™çš„å†…å®¹å¦‚ä¸‹ï¼š

```html
# è¿™ä¸ªæ˜¯obj.errorsçš„å†…å®¹ï¼Œè¿™é‡ŒåŒ…å«äº†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯ã€‚
# æœ¬èº«è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å› ä¸ºå®ç°äº†__str__æ–¹æ³•å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å¤§å †çš„å­—ç¬¦ä¸²ã€‚
<ul class="errorlist">
    <li>
        username
        <ul class="errorlist">
            <li>Ensure this value has at least 6 characters (it has 1).</li>		</ul>
    </li>
    <li>password
        <ul class="errorlist">
            <li>Ensure this value has at least 6 characters (it has 2).</li>		</ul>
    </li>
</ul>
```

åŒæ ·æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`obj.errors['username']`å•ç‹¬æ‹¿æŸä¸€ä¸ªnameå±æ€§çš„æŠ¥é”™ã€‚

```html
<ul class="errorlist">
    <li>Ensure this value has at least 6 characters (it has 1).</li>
</ul>
```

å¯¹åº”çš„å‰ç«¯ç•Œé¢å¦‚ä¸‹ï¼š

```html
<form  method="post">
    {% csrf_token %}
    <!--æˆ–è€…åªå–ç¬¬ä¸€ä¸ª{{ obj.errors.username.0 }}ï¼Œå› ä¸ºæœ‰å¯èƒ½ä½ è¿™ä¸ªè¾“å…¥çš„å†…å®¹å¥½å¤šæ¡è§„åˆ™éƒ½æ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆé”™è¯¯ä¿¡æ¯å°±åº”è¯¥æœ‰å¤šä¸ªï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦åœ¨å‰ç«¯æŠŠæ‰€æœ‰çš„æŠ¥é”™éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œåªéœ€è¦æ˜¾ç¤ºæŠ¥é”™å°±è¡Œäº†ï¼Œå› æ­¤åªè¦ä½ æœ‰æŠ¥é”™æˆ‘åªè®©ä½ æ˜¾ç¤ºç¬¬ä¸€ä¸ªå°±å¥½ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œé‚£å°±ä¸éœ€è¦æ˜¾ç¤ºäº†ã€‚-->
    <p>ç”¨æˆ·åï¼š<input type="text" name="username" />{{ obj.errors.username }}</p>
    <p>å¯†ç ï¼š<input type="password" name="password" />{{ obj.errors.password }}</p>
    <p><input type="submit" value="æäº¤"></p>
</form>
```

æ•ˆæœå¦‚ä¸‹ï¼š

![](http://omk1n04i8.bkt.clouddn.com/18-3-26/5961066.jpg)

### è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯

é€šè¿‡ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæŠ¥é”™æ˜¯è‹±æ–‡çš„ï¼Œé‚£ä¹ˆå¯ä¸å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰å‘¢ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚

```python
# ä¿®æ”¹æˆ‘ä»¬çš„formæ–‡ä»¶
class LoginForm(Form):
    username = fields.CharField(
        max_length=18,
        min_length=6,
        required=True, # è¿™ä¸ªé»˜è®¤æ˜¯å¿…å¡«é¡¹ï¼Œå°±ç®—ä½ ä¸å†™å‡ºæ¥ä¹Ÿä¼šåŒ…å«è¿™ä¸ªé»˜è®¤é¡¹
        error_messages={
            'required': 'ä¸èƒ½ä¸ºç©º',
            'min_length': 'å¤ªçŸ­äº†ï¼',
            'max_length': 'å¤ªé•¿äº†ï¼ï¼ï¼ï¼',
        }
    )
    password = fields.CharField(
        max_length=16,
        required=True,
        min_length=6,
    )
```

æ·»åŠ ä¸Šerror_messageå‚æ•°å°±å¯ä»¥äº†ï¼Œerror_messageå¯¹åº”çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œkeyæ˜¯å¯¹åº”çš„æˆ‘ä»¬æ·»åŠ çš„çº¦æŸé¡¹ç›®ï¼Œæ¯”å¦‚min_lengthæœ€å°é•¿åº¦ï¼Œmax_lengthæœ€å¤§é•¿åº¦å•Šï¼Œrequiredæ˜¯å¦å¿…å¡«ä¸èƒ½ä¸ºç©ºä»€ä¹ˆçš„ï¼Œå¯¹åº”çš„valueå°±æ˜¯è¦æŠ¥é”™çš„å€¼ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥å°†åŸæ¥çš„å†…å®¹æ›¿æ¢æˆæˆ‘ä»¬æƒ³å†™çš„å†…å®¹äº†ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ ¼å¼ä¸å¯¹çš„è¯å¯¹åº”çš„error_messageçš„keyæ˜¯`invalid`ï¼Œé’ˆå¯¹å…¶ä»–çš„fieldsè¿˜æœ‰å…¶ä»–çš„å±æ€§ï¼Œæ¯”å¦‚æ•°å­—Integerå±æ€§ï¼Œæœ‰æ•°å­—çš„æœ€å¤§å€¼`max_value`ï¼Œæœ€å°å€¼`min_value`ç­‰ä¸€äº›ç‰¹æ®Šçš„å±äºè‡ªå·±çš„å±æ€§ã€‚å…·ä½“çš„å¯ä»¥å‚è€ƒä¸‹é¢çš„Django Formå­—æ®µå±æ€§ã€‚

## Django Formå­—æ®µå±æ€§

> é’ˆå¯¹Django Formä¸­ä¸åŒçš„ç±»å‹éƒ½æœ‰ä»€ä¹ˆå±æ€§ï¼Œæ¯”å¦‚Integerå’ŒCharFieldéƒ½æ˜¯ç»§æ‰¿fieldsï¼Œå› æ­¤å®ƒä»¬éƒ½å¯ä»¥ä½¿ç”¨fieldsä¸­çš„å±æ€§ï¼ŒemailFieldç»§æ‰¿è‡ªCharFieldï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥æŠŠCharFieldä¸­çš„å±æ€§ç»§æ‰¿ä¸‹æ¥ï¼Œæˆ‘ä»¬çŸ¥é“EmailFieldæœ¬è´¨å…¶å®å°±æ˜¯CharFieldã€‚IntegerFieldä¼šä¸»åŠ¨çš„è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼ŒCharFieldä¹Ÿæ˜¯ã€‚å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°IntegerFieldä¸»åŠ¨çš„å»è°ƒç”¨çˆ¶ç±»çš„Fieldäº†ï¼Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•è¿˜æœ‰ä¸€å †å‚æ•°ã€‚
>
> ```python
> def __init__(self, *, max_value=None, min_value=None, **kwargs):
>     self.max_value, self.min_value = max_value, min_value
>     if kwargs.get('localize') and self.widget == NumberInput:
>         # Localized number input is not well supported on most browsers
>         kwargs.setdefault('widget', super().widget)
>     super().__init__(**kwargs)
> ```
>
> å…·ä½“éƒ½æœ‰ä»€ä¹ˆå±æ€§å¯ä»¥æŸ¥çœ‹ä¸‹é¢çš„å†…å®¹

- fields

  ```python
  required=True,               æ˜¯å¦å…è®¸ä¸ºç©ºï¼Œé»˜è®¤çš„éƒ½æ˜¯Trueï¼Œå¯ä»¥ä¸ç”¨å†™
  widget=None,                 HTMLæ’ä»¶
  label=None,                  ç”¨äºç”ŸæˆLabelæ ‡ç­¾æˆ–æ˜¾ç¤ºå†…å®¹
  initial=None,                åˆå§‹å€¼
  help_text='',                å¸®åŠ©ä¿¡æ¯(åœ¨æ ‡ç­¾æ—è¾¹æ˜¾ç¤º)
  error_messages=None,         é”™è¯¯ä¿¡æ¯ {'required': 'ä¸èƒ½ä¸ºç©º', 'invalid': 'æ ¼å¼é”™è¯¯'}
  show_hidden_initial=False,   æ˜¯å¦åœ¨å½“å‰æ’ä»¶åé¢å†åŠ ä¸€ä¸ªéšè—çš„ä¸”å…·æœ‰é»˜è®¤å€¼çš„æ’ä»¶ï¼ˆå¯ç”¨äºæ£€éªŒä¸¤æ¬¡è¾“å…¥æ˜¯å¦ä¸€ç›´ï¼‰
  validators=[],               è‡ªå®šä¹‰éªŒè¯è§„åˆ™ï¼Œåœ¨åŸæœ‰çš„è§„åˆ™ä¸Šç»§ç»­æ·»åŠ æ­£åˆ™
  localize=False,              æ˜¯å¦æ”¯æŒæœ¬åœ°åŒ–ï¼Œæ¯”å¦‚æ—¶é—´çš„æ—¶åŒºã€‚
  disabled=False,              æ˜¯å¦å¯ä»¥ç¼–è¾‘
  label_suffix=None            Labelå†…å®¹åç¼€
  ```

- URLField(Field)

- BooleanField(Field)  

- NullBooleanField(BooleanField)

- CharField

  ```python
  max_length=None,             æœ€å¤§é•¿åº¦
  min_length=None,             æœ€å°é•¿åº¦
  strip=True                   æ˜¯å¦ç§»é™¤ç”¨æˆ·è¾“å…¥ç©ºç™½ï¼Œstripå±æ€§æ˜¯é»˜è®¤çš„ï¼Œé»˜è®¤ä¸ºtrueã€‚
  
  UUIDField(CharField)         uuidç±»å‹
  SlugField(CharField)         æ•°å­—ï¼Œå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œå‡å·ï¼ˆè¿å­—ç¬¦ï¼‰
  ```

- IntegerField

  ```python
  max_value=None,              æœ€å¤§å€¼
  min_value=None,              æœ€å°å€¼
  
  # FloatField(IntegerField)
  ```

- DecimalField(IntegerField)

  ```python
  max_value=None,              æœ€å¤§å€¼
  min_value=None,              æœ€å°å€¼
  max_digits=None,             æ€»é•¿åº¦
  decimal_places=None,         å°æ•°ä½é•¿åº¦
  ```

- BaseTemporalField(Field)

  ```python
  input_formats=None          æ—¶é—´æ ¼å¼åŒ–
  
  
  DateField(BaseTemporalField)    æ ¼å¼ï¼š2015-09-01
  TimeField(BaseTemporalField)    æ ¼å¼ï¼š11:12
  DateTimeField(BaseTemporalField)æ ¼å¼ï¼š2015-09-01 11:12
  ```

- DurationField(Field)            æ—¶é—´é—´éš”ï¼š%d %H:%M:%S.%f

- RegexField(CharField)    å¦‚æœæä¾›çš„ä¸å¤Ÿç”¨ï¼Œæ”¯æŒè‡ªå·±ä¹¦å†™æ­£åˆ™è¡¨è¾¾å¼

  ```python
  regex,                      è‡ªå®šåˆ¶æ­£åˆ™è¡¨è¾¾å¼
  max_length=None,            æœ€å¤§é•¿åº¦
  min_length=None,            æœ€å°é•¿åº¦
  error_message=None,         å¿½ç•¥ï¼Œé”™è¯¯ä¿¡æ¯ä½¿ç”¨ error_messages={'invalid': '...'}
  ```

- EmailField(CharField)

- FileField(Field)              

  ```python
  allow_empty_file=False     æ˜¯å¦å…è®¸ç©ºæ–‡ä»¶
  ```

- ImageField(FileField) 

  ```python
  æ³¨ï¼šéœ€è¦PILæ¨¡å—ï¼Œpip3 install Pillow
  ä»¥ä¸Šä¸¤ä¸ªå­—å…¸ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š
      - formè¡¨å•ä¸­ enctype="multipart/form-data"
      - viewå‡½æ•°ä¸­ obj = MyForm(request.POST, request.FILES)
  ```

- ChoiceField(Field)

  ```python
  choices=(),                é€‰é¡¹ï¼Œå¦‚ï¼šchoices = ((0,'ä¸Šæµ·'),(1,'åŒ—äº¬'),)
  required=True,             æ˜¯å¦å¿…å¡«
  widget=None,               æ’ä»¶ï¼Œé»˜è®¤selectæ’ä»¶
  label=None,                Labelå†…å®¹
  initial=None,              åˆå§‹å€¼
  help_text='',              å¸®åŠ©æç¤º
  ```

- MultipleChoiceField(ChoiceField)

- ModelChoiceField(ChoiceField)

  ```python
  ...                        django.forms.models.ModelChoiceField
  queryset,                  # æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®
  empty_label="---------",   # é»˜è®¤ç©ºæ˜¾ç¤ºå†…å®¹
  to_field_name=None,        # HTMLä¸­valueçš„å€¼å¯¹åº”çš„å­—æ®µ
  limit_choices_to=None      # ModelFormä¸­å¯¹querysetäºŒæ¬¡ç­›é€‰
  ```

- ModelMultipleChoiceField(ModelChoiceField)

  ```python
  ...                        django.forms.models.ModelMultipleChoiceField
  ```

- TypedChoiceField(ChoiceField)

  ```python
  coerce = lambda val: val   å¯¹é€‰ä¸­çš„å€¼è¿›è¡Œä¸€æ¬¡è½¬æ¢
  empty_value= ''            ç©ºå€¼çš„é»˜è®¤å€¼
  ```

- TypedMultipleChoiceField(MultipleChoiceField)

  ```python
  coerce = lambda val: val   å¯¹é€‰ä¸­çš„æ¯ä¸€ä¸ªå€¼è¿›è¡Œä¸€æ¬¡è½¬æ¢
  empty_value= ''            ç©ºå€¼çš„é»˜è®¤å€¼
  ```

- ComboField(Field)ï¼Œå¤šä¸ªéªŒè¯è§„åˆ™ç»„åˆ

  ```python
  fields=()                  
  # ä½¿ç”¨å¤šä¸ªéªŒè¯ï¼Œå¦‚ä¸‹ï¼šå³éªŒè¯æœ€å¤§é•¿åº¦20ï¼ŒåˆéªŒè¯é‚®ç®±æ ¼å¼
  fields.ComboField(fields=[fields.CharField(max_length=20), fields.EmailField(),])
  ```

- MultiValueField(Field)

  ```python
  PS: æŠ½è±¡ç±»ï¼Œå­ç±»ä¸­å¯ä»¥å®ç°èšåˆå¤šä¸ªå­—å…¸å»åŒ¹é…ä¸€ä¸ªå€¼ï¼Œè¦é…åˆMultiWidgetä½¿ç”¨
  ```

- SplitDateTimeField(MultiValueField)

  ```python
  input_date_formats=None,   æ ¼å¼åˆ—è¡¨ï¼š['%Y--%m--%d', '%m%d/%Y', '%m/%d/%y']
  input_time_formats=None    æ ¼å¼åˆ—è¡¨ï¼š['%H:%M:%S', '%H:%M:%S.%f', '%H:%M']
  ```

- FilePathField(ChoiceField)     æ–‡ä»¶é€‰é¡¹ï¼Œç›®å½•ä¸‹æ–‡ä»¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸­

  ```python
  path,                      æ–‡ä»¶å¤¹è·¯å¾„
  match=None,                æ­£åˆ™åŒ¹é…
  recursive=False,           é€’å½’ä¸‹é¢çš„æ–‡ä»¶å¤¹
  allow_files=True,          å…è®¸æ–‡ä»¶
  allow_folders=False,       å…è®¸æ–‡ä»¶å¤¹
  required=True,
  widget=None,
  label=None,
  initial=None,
  help_text=''
  ```

- GenericIPAddressField

  ```python
  protocol='both',           both,ipv4,ipv6æ”¯æŒçš„IPæ ¼å¼
  unpack_ipv4=False          è§£æipv4åœ°å€ï¼Œå¦‚æœæ˜¯::ffff:192.0.2.1æ—¶å€™ï¼Œ
              			   å¯è§£æä¸º192.0.2.1ï¼Œ PSï¼šprotocolå¿…é¡»ä¸ºbothæ‰èƒ½å¯ç”¨
  ```

### è‡ªå®šåˆ¶æ­£åˆ™è¡¨è¾¾å¼

ä¸¾ä¸ªğŸŒ°ï¼š

```python
# regexfieldç»§æ‰¿charfieldï¼Œå¯ä»¥ä½¿ç”¨æ˜¯å¦ä¸ºç©ºï¼Œæœ€é•¿æœ€çŸ­ï¼Œè¿˜æœ‰è‡ªå·±å†™çš„ï¼Œä¸€å…±4ç§
t = fields.RegexField('139\d+', error_messages={'invalid': 'æ ¼å¼é”™è¯¯'})
```

## ç®€å•å®ç°åŸç†

fieldsæœ¬è´¨å°±æ˜¯éªŒè¯è§„åˆ™ï¼Œè¯´éªŒè¯è§„åˆ™å®è´¨å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ã€‚å¯ä»¥è¯´æˆ‘ä»¬å†™çš„è¿™ä¸ªFormç±»ä¼¼ä¸€ä¸ªæ ¡éªŒçš„æ¨¡æ¿ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å†…éƒ¨æ˜¯å¦‚ä½•å®ç°éªŒè¯çš„ï¼ˆis_validçš„å®ç°è¿‡ç¨‹ï¼‰ã€‚

1. æ¯ä¸€æ¬¡å®ä¾‹åŒ–Formç»„ä»¶ç±»çš„æ—¶å€™ï¼Œä¼šå…ˆæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯æŠŠå½“å‰å®šä¹‰çš„å­—æ®µæ”¾åˆ°self.fieldsä¸­æ¥ã€‚

   ```python
   # å®ä¾‹åŒ–çš„æ—¶å€™ï¼šobj = LoginForm(request.POST)æ‰¾åˆ°å¯¹åº”çš„Formç»„ä»¶ç±»ä¸­çš„æ‰€æœ‰å­—æ®µ
   # æŠŠè¿™äº›å­—æ®µæ”¾åˆ°self.fieldsä¸­
   self.fields = {
       'username': fields.CharField(xxxxx) # åŒ…å«æ­£åˆ™è¡¨è¾¾å¼
       'password': æ­£åˆ™2
   }
   ```

2. å¾ªç¯self.fieldsï¼š

   ```python
   flag = True
   errors = xxx  # å½“æ•°æ®æ ¡éªŒå¤±è´¥çš„æ—¶å€™ï¼Œå°†å†…å®¹æ”¾åˆ°errorsä¸­æ¥
   cleand_data = xxx  # å½“æ•°æ®æ ¡éªŒæˆåŠŸçš„æ—¶å€™ï¼Œå°†å†…å®¹æ”¾åˆ°cleand_dataä¸­ã€‚
   for k, v in self.fields.items():
     # kå°±æ˜¯æ¯ä¸ªnameå±æ€§å­—æ®µï¼Œæ¯”å¦‚usernameï¼Œpasswordï¼Œvå°±æ˜¯å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼
     # è·å–åˆ°ç”¨æˆ·è¾“å…¥çš„å†…å®¹
     input_value = request.POST.get(k)
     # é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å’Œç”¨æˆ·è¾“å…¥çš„å†…å®¹æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚
     # å¦‚æœè¯´æ ¡éªŒæˆåŠŸï¼Œå°±è¿”å›Trueçš„flagå¹¶å‘æˆåŠŸçš„æ•°æ®æ”¾å…¥åˆ°cleaned_data
     # å¦‚æœè¯´æ ¡éªŒå¤±è´¥äº†ï¼Œè¿”å›ä¸€ä¸ªFalseçš„flagï¼Œå¹¶æŠŠæ•°æ®æ”¾åˆ°errors
     # æ³¨æ„è¿™é‡Œæ˜¯ä½†å‡¡æœ‰ä¸€æ¡æ ¡éªŒå¤±è´¥éƒ½ä¼šè¿”å›false
     if not æ­£åˆ™æ ¡éªŒï¼Œç”¨re.match(xxxxx):
    	flag = False
     return flagæ ‡å¿—ä½
   ```